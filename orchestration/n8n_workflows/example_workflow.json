{
  "meta": {
    "name": "Daily SKU replenishment",
    "notes": "Parametrized example n8n workflow"
  },
  "nodes": [
    {
      "id": "initSku",
      "name": "Set sku_id",
      "type": "n8n-nodes-base.set",
      "typeVersion": 2,
      "position": [200, 80],
      "parameters": {
        "keepOnlySet": true,
        "values": {
          "string": [
            {
              "name": "sku_id",
              "value": "FOODS_3_090_CA_1_validation"
            }
          ]
        }
      }
    },
    {
      "id": "scheduleTrigger",
      "name": "Daily Schedule",
      "type": "n8n-nodes-base.cron",
      "typeVersion": 1,
      "position": [200, 200],
      "parameters": {
        "triggerTimes": {
          "item": [
            {
              "mode": "everyDay",
              "minute": 0,
              "hour": 6
            }
          ]
        }
      }
    },
    {
      "id": "httpForecast",
      "name": "Get forecast",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 1,
      "position": [480, 200],
      "parameters": {
        "url": "={{$env.API_URL}}/forecasts/{{$json.sku_id}}",
        "method": "GET",
        "responseFormat": "json"
      }
    },
    {
      "id": "httpProcure",
      "name": "Get recommendation",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 1,
      "position": [760, 200],
      "parameters": {
        "url": "={{$env.API_URL}}/procure/recommendations",
        "method": "POST",
        "responseFormat": "json",
        "jsonParameters": true,
        "body": {
          "sku_id": "={{$json.sku_id}}",
          "horizon_days": 28
        }
      }
    },
    {
      "id": "httpExplain",
      "name": "Explain recommendation",
      "type": "n8n-nodes-base.function",
      "typeVersion": 1,
      "position": [1040, 200],
      "parameters": {
        "functionCode": "// Optionally call an explanation endpoint here.\nreturn items;"
      }
    },
    {
      "id": "slackNotify",
      "name": "Notify approver",
      "type": "n8n-nodes-base.slack",
      "typeVersion": 1,
      "position": [1240, 200],
      "parameters": {
        "resource": "message",
        "operation": "post",
        "authentication": "accessToken",
        "channel": "#approvals",
        "text": "Recommendation for {{$json.sku_id}}: order {{$json.order_qty}}.\nApprove: {{$env.WEB_BASE}}/approval?decision=approve&sku={{$json.sku_id}}&qty={{$json.order_qty}}&reason=Approved%20via%20Slack\nReject: {{$env.WEB_BASE}}/approval?decision=reject&sku={{$json.sku_id}}&qty={{$json.order_qty}}&reason=Rejected%20via%20Slack"
      }
    },
    {
      "id": "webhookDecision",
      "name": "Approval webhook",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 1,
      "position": [1440, 80],
      "parameters": {
        "httpMethod": "GET",
        "path": "approval",
        "responseMode": "onReceived",
        "responseData": "text",
        "responseBody": "Received"
      }
    },
    {
      "id": "postApproval",
      "name": "Post approval",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 1,
      "position": [1640, 80],
      "parameters": {
        "url": "={{$env.API_URL}}/approvals",
        "method": "POST",
        "jsonParameters": true,
        "responseFormat": "json",
        "options": {},
        "body": {
          "sku_id": "={{$json.query.sku}}",
          "action": "={{$json.query.decision}}",
          "qty": "={{$json.query.qty}}",
          "reason": "={{$json.query.reason || 'Decision captured via Slack link'}}"
        }
      }
    }
  ],
  "connections": {
    "scheduleTrigger": {
      "main": [
        [
          {
            "node": "initSku",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "initSku": {
      "main": [
        [
          {
            "node": "httpForecast",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "httpForecast": {
      "main": [
        [
          {
            "node": "httpProcure",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "httpProcure": {
      "main": [
        [
          {
            "node": "httpExplain",
            "type": "main",
            "index": 0
          },
          {
            "node": "slackNotify",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "webhookDecision": {
      "main": [
        [
          {
            "node": "postApproval",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  }
}
